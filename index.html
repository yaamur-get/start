<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تدشين المقر</title>
  <style>
    :root {
      --bg: #f7f9fb;
      --btn-bg: #ffffff;
      --btn-border: #dbe3ea;
      --brand: #0b5d3b;
      --text: #0e1116;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --ring: rgba(11,93,59,.15);
      --duration: 1000ms;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      display: grid;
      place-items: center;
      transition: background 800ms ease;
      overflow: hidden; /* عشان القصاصات ما تسبب سكرول */
    }

    .wrap { display: grid; place-items: center; gap: 28px; }

    /* زر اللوقو (كبّرته افتراضياً—عدّل الأرقام لو تبغى أكبر) */
    .logo-button {
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      border-radius: 24px;
      padding: 60px 80px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
      position: relative;
      outline: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .logo-button img {
      width: 550px;
      height: auto;
      display: block;
    }
    .logo-button::after {
      content: "";
      position: absolute;
      inset: -8px;
      border-radius: 28px;
      box-shadow: 0 0 0 0 var(--ring);
      transition: box-shadow .2s ease;
    }
    .logo-button:hover { transform: translateY(-2px); box-shadow: 0 16px 40px rgba(0,0,0,.12); }
    .logo-button:active { transform: translateY(0); box-shadow: var(--shadow); }
    .logo-button:focus-visible::after { box-shadow: 0 0 0 8px var(--ring); }

    /* طبقة العداد */
    .overlay {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(255,255,255,0.96);
      transition: background 600ms ease, opacity 300ms ease;
      opacity: 0;
      pointer-events: none;
      z-index: 10;
    }
    .overlay.show { opacity: 1; pointer-events: auto; }

    .countdown {
      width: clamp(220px, 32vw, 360px);
      height: clamp(220px, 32vw, 360px);
      position: relative;
      display: grid;
      place-items: center;
    }
    .countdown__number {
      position: absolute;
      font-size: clamp(64px, 9vw, 110px);
      font-weight: 800;
      color: var(--brand);
      line-height: 1;
    }
    .countdown__label {
      position: absolute;
      bottom: 14px;
      font-size: clamp(12px, 1.6vw, 16px);
      color: #5b6b75;
      letter-spacing: .5px;
    }
    .ring { transform: rotate(-90deg); }
    .ring circle { fill: none; stroke-width: 14; stroke-linecap: round; }
    .ring__bg { stroke: #e7eef3; }
    .ring__fg {
      stroke: var(--brand);
      stroke-dasharray: 100 100;
      stroke-dashoffset: 100;
      transition: stroke-dashoffset var(--duration) ease;
      filter: drop-shadow(0 6px 16px rgba(11,93,59,.25));
    }

    /* كان في blackout – حذفته واستبدلناه بمشهد المؤثرات */

    /* كانفاس المؤثرات يغطي الشاشة */
    #fx {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      display: block;
      pointer-events: none;
      z-index: 20;
      opacity: 0;
      transition: opacity 300ms ease;
    }
    #fx.on { opacity: 1; }

    @media (prefers-reduced-motion: reduce) {
      .logo-button, .ring__fg { transition: none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <button class="logo-button" id="launchBtn" aria-label="بدء التدشين">
      <img src="./3.png" alt="لوقو" />
    </button>
  </div>

  <!-- طبقة العداد -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="countdown" role="status" aria-live="polite">
      <svg class="ring" viewBox="0 0 100 100" width="100%" height="100%" aria-hidden="true">
        <circle class="ring__bg" cx="50" cy="50" r="42"></circle>
        <circle class="ring__fg" id="ringFg" cx="50" cy="50" r="42"></circle>
      </svg>
      <div class="countdown__number" id="countNum">1</div>
    </div>
  </div>

  <!-- كانفاس المؤثرات -->
  <canvas id="fx"></canvas>

  <!-- صوت الاحتفال: ضع celebration.mp3 بجانب الصفحة -->
  <audio id="celebration" src="./claap.mp3" preload="auto"></audio>

  <script>
    const launchBtn = document.getElementById('launchBtn');
    const overlay   = document.getElementById('overlay');
    const ringFg    = document.getElementById('ringFg');
    const countNum  = document.getElementById('countNum');

    // FX
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d');
    const audio = document.getElementById('celebration');

    // تحجيم الكانفاس
    function resizeCanvas(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width  = Math.floor(innerWidth * dpr);
      canvas.height = Math.floor(innerHeight * dpr);
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // حساب محيط الدائرة للتقدم
    const R = 42;
    const CIRC = 2 * Math.PI * R;
    ringFg.style.strokeDasharray = `${CIRC} ${CIRC}`;
    ringFg.style.strokeDashoffset = CIRC;

    function setProgress(percent) {
      const offset = CIRC * (1 - percent / 100);
      ringFg.style.strokeDashoffset = offset;
    }

    // فتح الصوت عبر أول نقرة (للسماح على الجوال)
    let audioUnlocked = false;
    async function unlockAudio(){
      if (audioUnlocked) return;
      try {
        audio.volume = 0;
        await audio.play();
        await audio.pause();
        audio.currentTime = 0;
        audio.volume = 1;
        audioUnlocked = true;
      } catch (e) {
        // تجاهل؛ بنحاول تشغيله لاحقًا أيضًا
      }
    }

    // نظام الجزيئات (confetti/explosions)
    const particles = [];
    const GRAVITY = 0.35;
    const DRAG = 0.992;
    const COLORS = ['#0b5d3b','#15803d','#16a34a','#22c55e','#84cc16','#f59e0b','#ef4444','#3b82f6','#a855f7','#ec4899','#ffffff'];
    const TAU = Math.PI * 2;

    function rnd(min, max){ return Math.random() * (max - min) + min; }
    function pick(arr){ return arr[(Math.random() * arr.length) | 0]; }

    function spawnBurst(x, y, count = 60, power = 16){
      for (let i=0;i<count;i++){
        const angle = rnd(0, TAU);
        const speed = rnd(power * 0.6, power * 1.2);
        const size  = rnd(3, 6);
        particles.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed - rnd(2,6),
          rot: rnd(0, TAU),
          vr: rnd(-0.2, 0.2),
          life: rnd(60, 120),
          size,
          color: pick(COLORS),
          shape: Math.random() < 0.6 ? 'rect' : 'circle'
        });
      }
    }

    function animate(){
      if (particles.length === 0) return; // لا ترسم لو ما فيه شيء
      requestAnimationFrame(animate);
      ctx.clearRect(0,0,canvas.width,canvas.height);

      for (let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.vx *= DRAG;
        p.vy = p.vy * DRAG + GRAVITY;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.life--;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        if (p.shape === 'rect'){
          ctx.fillRect(-p.size, -p.size*0.6, p.size*2, p.size*1.2);
        } else {
          ctx.beginPath();
          ctx.arc(0,0,p.size,0,TAU);
          ctx.fill();
        }
        ctx.restore();

        if (p.life <= 0 || p.y > innerHeight + 80) particles.splice(i,1);
      }
    }

    function finale(){
      // إظهار الكانفاس
      canvas.classList.add('on');

      // موجة متفجرات تملأ الشاشة ~3 ثوانٍ
      const start = performance.now();
      const duration = 3000;
      const w = innerWidth, h = innerHeight;

      function loop(t){
        const elapsed = t - start;
        const progress = Math.min(1, elapsed / duration);

        // كل 120ms نسوي عدة انفجارات موزّعة أفقياً
        if (!loop.last || t - loop.last > 120){
          const rows = 3;
          const cols = 6;
          for (let r=0; r<rows; r++){
            for (let c=0; c<cols; c++){
              const x = (c + Math.random()*0.5) / cols * w + w*0.02;
              const y = (r + Math.random()*0.3) / rows * h * 0.7 + h*0.15;
              spawnBurst(x, y, 40, 14 + 10*progress);
            }
          }
          loop.last = t;
        }

        if (elapsed < duration){
          requestAnimationFrame(loop);
        } else {
          // رشة أخيرة قوية من الوسط
          spawnBurst(w*0.5, h*0.5, 160, 22);
        }
      }
      requestAnimationFrame(loop);

      // تشغيل الصوت
      audio.loop = false; // خلّه تشغيلة وحدة؛ لو تبي تكرار خلها true
      audio.volume = 1;
      audio.play().catch(()=>{ /* يمكن المتصفح مانع؛ تم فتحه سابقًا */ });

      // بدء الرسم
      if (particles.length && !finale.animStarted){
        finale.animStarted = true;
        animate();
      } else {
        // لو ما انطلقت بعد، شغّل الأنميشن فورًا
        requestAnimationFrame(animate);
      }
    }

    launchBtn.addEventListener('click', () => {
      unlockAudio(); // فتح الصوت مباشرة بعد أول تفاعل

      // إظهار طبقة العداد وإخفاء الزر
      launchBtn.style.visibility = 'hidden';
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden', 'false');

      // عداد 1 → 2 → 3
      const steps = [
        {n: 1, p: 33},
        {n: 2, p: 66},
        {n: 3, p: 100},
      ];

      let step = 0;
      countNum.textContent = steps[0].n;
      setProgress(steps[0].p);

      const timer = setInterval(() => {
        step++;
        if (step < steps.length) {
          countNum.textContent = steps[step].n;
          setProgress(steps[step].p);
        } else {
          clearInterval(timer);

          // أخفي العداد ثم شغّل النهائي
          overlay.style.opacity = 0;
          setTimeout(() => {
            overlay.remove();
            finale();
          }, 300);
        }
      }, 1000);
    });
  </script>
</body>
</html>


